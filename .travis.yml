language: node_js
node_js:
  - stable

# Use a simple Trusty Tahr server to deploy.
os: linux
dist: trusty
sudo: required

addons:
  apt:
    packages:
      - nginx

install:
  # Lint, build and test UnSHACLed.
  - pushd UnSHACLed; npm install && gulp; popd
  # Patch the server configuration and install it.
  - ./patch-server.sh $(pwd)/UnSHACLed
  - sudo ./install-server.sh

script:
  # Stop the server if it's already been launched.
  - sudo ./stop-server.sh
  # Launch the server.
  - sudo ./start-server.sh
  - ls -l /etc/nginx/sites-available
  - ls -l /etc/nginx/sites-enabled
  - cat /etc/nginx/sites-available/default
  # Try to download a bunch of files.
  - wget -O - http://localhost/index.html
  - wget http://localhost/dist/unshacled.min.js
  # Shut the server down.
  - sudo ./stop-server.sh
